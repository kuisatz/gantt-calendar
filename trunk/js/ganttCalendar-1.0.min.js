/*
 * COPYRIGHT - Julien CORON - 2012
 */
TimeLineMonth=function(a,e,d,c,b){return this.init(a,e,d,c,b)};$.extend(TimeLineMonth.prototype,{container:"",month:"",year:"",days:{1:[31,31],2:[28,29],3:[31,31],4:[30,30],5:[31,31],6:[30,30],7:[31,31],8:[31,31],9:[30,30],10:[31,31],11:[30,30],12:[31,31]},lang:"fr",months:{fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"],en:["January","February","March","April","May","June","July","Agust","September","October","November","December"]},ressourcesColumnHeader:"Ressources",init:function(a,e,d,c,b){this.container=a;this.month=e;this.year=d;this.ressources=c;this.updateMonthCallback=b||function(){};this.drawElements();this.updateMonthCallback();return this},drawElements:function(){var i=$("#"+this.container);i.timeLineMonth=this;var p=$(document.createElement("div")).addClass("largeCalendar");i.html(p);var l=$(document.createElement("div")).addClass("month");p.html(l);l.html('<div class="prevMonth"></div>		<div class="nameMonth">'+this.months[this.lang][this.month-1]+" "+this.year+'</div>		<div class="nextMonth" id="nextMonth"></div>');var g=$(document.createElement("div")).addClass("leftColumn horizontalCalendarHeaders");p.append(g);var f=$(document.createElement("div")).addClass("eventsContainer");p.append(f);var n=$(document.createElement("div")).addClass("headerRessources");g.html(n);f.width(p.width()-n.width()-1);var b=$(document.createElement("span")).addClass("labelCenter").html(this.ressourcesColumnHeader);n.html(b);var m=$(document.createElement("div")).addClass("listRessources");g.append(m);for(var d=0;d<this.ressources.groups.length;d++){var h=this.ressources.groups[d];m.append('<div id="group_'+h.id+'" class="group">					<span class="labelLeft">'+h.name+"</span>				</div>");for(var c=0;c<h.ressources.length;c++){var q=h.ressources[c];m.append('<div id="ressource_'+q.id+'" data-group="group_'+h.id+'" class="ressource lineRessource">					<span class="labelRight">'+q.name+"</span>					</div>")}}var a=((this.year%4==0&&this.year%100!=0)||this.year%400==0)?(1):(0);var o=$(document.createElement("div")).addClass("horizontalCalendarContent for"+this.days[this.month][a]+"days").attr("tabindex","0");f.append(o);var j=$(document.createElement("div")).addClass("lineOfDays");o.html(j);var r="";for(var k=1;k<=this.days[this.month][a];k++){var e=k;r+='<div class="day" id="day_'+e+'">'+e+"</div>"}j.html(r);for(var d=0;d<this.ressources.groups.length;d++){var h=this.ressources.groups[d];o.append('<div data-group="group_'+h.id+'" class="group">&nbsp;</div>');for(var c=0;c<h.ressources.length;c++){var q=h.ressources[c];o.append('<div class="lineForRessource" data-ressource="ressource_'+q.id+'" id="events_r_'+q.id+'"></div>')}}this.defineEvents(this)},goToNextMonth:function(){if(this.month==12){this.month=1;this.year++}else{this.month++}this.drawElements();this.updateMonthCallback()},goToPrevMonth:function(){if(this.month==1){this.month=12;this.year--}else{this.month--}this.drawElements();this.updateMonthCallback()},updateWidth:function(){$(".eventsContainer").width($(".largeCalendar").width()-$(".headerRessources").width()-1)},defineEvents:function(a){$(".prevMonth").click(function(){a.goToPrevMonth()});$(".nextMonth").click(function(){a.goToNextMonth()});$(".horizontalCalendarContent").keydown(function(b){switch(b.keyCode){case 34:a.goToPrevMonth();$(".horizontalCalendarContent").focus();break;case 33:a.goToNextMonth();$(".horizontalCalendarContent").focus();break;default:break}})}});Event=function(e,b,d,c,a){this.init(e,b,d,c,a)};$.extend(Event.prototype,{ressourceId:"",eventId:"",startDay:"",endDay:"",label:"",init:function(e,b,d,c,a){this.ressourceId=e;this.eventId=b;this.startDay=d;this.endDay=c;this.label=a},drawIn:function(a){var c=50*(this.startDay-1);var b=50*(this.endDay-this.startDay)-3;$("#"+a).find("#events_r_"+this.ressourceId).append('<div id="'+this.eventId+'" class="event" style="left: '+c+"px;width:"+b+'px;">'+this.label+"</div>");$("#"+a).find("#"+this.eventId).draggable({axis:"x",containment:"parent",opacity:0.5,snap:true});$("#"+a).find("#events_r_"+this.ressourceId).droppable({drop:function(e,h){var d=$(this).offset().left;var g=h.offset.left;var f=1+((g-d)/50);$(".debug").html("newDayStart: "+f)}});return this}});
