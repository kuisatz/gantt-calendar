<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Calendar Gantt</title>
<link href="style.css" media="screen, projection" rel="stylesheet" type="text/css" />

<!--  jquery core -->
<script src="js/jquery/jquery-1.4.1.min.js" type="text/javascript"></script>
<script src="js/jquery/jquery-ui.min.js" type="text/javascript"></script>



<script type="text/javascript">

TimeLineMonth = function(container, month, year, ressources) {
	  this.init(container, month, year, ressources);
}

$.extend(TimeLineMonth.prototype, {
	// object variables
	container:'',
	month: '',
	year: '',
	days: {1:[31,31],2:[28,29],3:[31,31],4:[30,30],5:[31,31],6:[30,30],
		7:[31,31],8:[31,31],9:[30,30],10:[31,31],11:[30,30],12:[31,31]
	},
	lang: 'fr',
	months: {'fr':["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Aout", "Septembre", "Octobre", "Novembre", "Décembre"],
		'en':["January", "February", "March", "April", "May", "June", "July", "Agust", "September", "October", "November", "December"]
	},
	ressourcesColumnHeader : 'Ressources',
	init: function(container, month, year, ressources) {
		this.container = container;
		this.month = month;
		this.year = year;
		this.ressources = ressources;
		this.drawElements();
	},

	drawElements: function() {
		var containerObj = $("#"+this.container);
		var largeCalendar = $( document.createElement('div') ).addClass("largeCalendar");
		containerObj.html(largeCalendar);
		
		var monthLine = $( document.createElement('div') ).addClass("month");
		largeCalendar.html(monthLine);
		monthLine.html("<div class=\"prevMonth\"></div>\
		<div class=\"nameMonth\">"+this.months[this.lang][this.month-1]+" "+this.year+"</div>\
		<div class=\"nextMonth\"></div>");
		
		var calendarHeaders = $( document.createElement('div') ).addClass("leftColumn horizontalCalendarHeaders");
		largeCalendar.append(calendarHeaders);
		
		var container = $( document.createElement('div') ).addClass("container");
		largeCalendar.append(container);
		
		
		var headerRessources = $( document.createElement('div') ).addClass("headerRessources");
		calendarHeaders.html(headerRessources);
		
		var spanLabelCenter = $( document.createElement('span') ).addClass("labelCenter").html(this.ressourcesColumnHeader);
		headerRessources.html(spanLabelCenter);
		
		var listRessources = $( document.createElement('div') ).addClass("listRessources");
		calendarHeaders.append(listRessources);
		
		
		// All groups and ressources, prepare left side
		for(var indexGroup=0;indexGroup<this.ressources.groups.length;indexGroup++){
			var group = this.ressources.groups[indexGroup];
			listRessources.append("<div id=\"group_"+group.id+"\" class=\"group\">\
					<span class=\"labelLeft\">"+group.name+"</span>\
				</div>");
			
			for(var indexRessource=0;indexRessource<group.ressources.length;indexRessource++){
				var ressource = group.ressources[indexRessource];
				listRessources.append("<div id=\"ressource_"+ressource.id+"\" data-group=\"group_"+group.id+"\" class=\"ressource lineRessource\">\
					<span class=\"labelRight\">"+ressource.name+"</span>\
					</div>");
			}
		}
		
		var bisextile = ((this.year % 4) && !(this.year % 100))?(1):(0);
		var horizontalCalendarContent = $( document.createElement('div') )
			.addClass("horizontalCalendarContent for"+this.days[this.month][bisextile]+"days");
		container.append(horizontalCalendarContent);
		
		var lineOfDays = $( document.createElement('div') ).addClass("lineOfDays");
		horizontalCalendarContent.html(lineOfDays);
		
		var htmlDays = "";
		for(var indexDay=1;indexDay<=this.days[this.month][bisextile];indexDay++){
			var day2digits = indexDay;
			htmlDays += "<div class=\"day\" id=\"day_"+day2digits+"\">"+day2digits+"</div>";
		}
		lineOfDays.html(htmlDays);
		
		// All groups and ressources, prepare content
		for(var indexGroup=0;indexGroup<this.ressources.groups.length;indexGroup++){
			var group = this.ressources.groups[indexGroup];
			horizontalCalendarContent.append("<div data-group=\"group_"+group.id+"\" class=\"group\">&nbsp;</div>");
			
			for(var indexRessource=0;indexRessource<group.ressources.length;indexRessource++){
				var ressource = group.ressources[indexRessource];
				horizontalCalendarContent.append("<div class=\"lineForRessource\" data-ressource=\"ressource_"+ressource.id+"\" id=\"events_r_"+ressource.id+"\"></div>");
			}
		}
		
	}
});

Event = function(ressourceId, eventId, startDay, endDay, label) {
	  this.init(ressourceId, eventId, startDay, endDay, label);
}

$.extend(Event.prototype, {
	// object variables
	ressourceId: '',
	eventId: '',
	startDay: '',
	endDay: '',
	label: '',
	
	init: function(ressourceId, eventId, startDay, endDay, label) {
		this.ressourceId = ressourceId;
		this.eventId = eventId;
		this.startDay = startDay;
		this.endDay = endDay;
		this.label = label;
	},

	drawIn: function(containerId) {
		var margin = 50 * (this.startDay - 1);
		var width = 50 * (this.endDay - this.startDay) - 3;
		
		$("#"+containerId).find("#events_r_"+this.ressourceId).append('<div id="'+this.eventId+'" class="event" style="left: '+margin+'px;width:'+width+'px;">'+this.label+'</div>');
		$("#"+containerId).find("#"+this.eventId).draggable({ axis: "x", containment: "parent", opacity: 0.5, snap: true });
		$("#"+containerId).find("#events_r_"+this.ressourceId).droppable({
			drop: function(event, ui){
				var containerLeft = $(this).offset().left;
				var eventLeft = ui.offset.left;
				var newDayStart = 1 + ((eventLeft - containerLeft) / 50); // px
				//alert("newDayStart: "+  newDayStart );
			}
		});
		return this; 
	}
});


$(function() {

	var timeline = new TimeLineMonth("myGanttCalendar",11, 2012,
			{groups: 
				[  {name: "Singers",
					id: 1,
					ressources: [{name:"Henri", id:1}, 
					             {name:"Frank", id:2},
					             {name:"Jenny", id:3}]
				}, {name: "Objects",
					id: 2,
					ressources: [{name:"Micro",id:4}, 
					             {name:"Ampli", id:5}]
				}]
			}
	);

	var evt1 = new Event(1, "event_001", 2, 5, "Event Paris - WSDD").drawIn("myGanttCalendar");
	var evt2 = new Event(2, "event_002", 2, 5, "Paris - WSDD(2-5)").drawIn("myGanttCalendar");
/*
	addEvent("events_r001", "event_001", 2, 5, "Event Paris - WSDD");
	addEvent("events_r002", "event_002", 2, 5, "Paris - WSDD(2-5)");
	addEvent("events_r002", "event_002b", 3, 5, "SF - EEES(3-5)");
	addEvent("events_r003", "event_003", 7, 9, "team (7-9)");
	addEvent("events_r004", "event_004", 1.5, 5.5, "Same thing");
	addEvent("events_r005", "event_005", 4, 5, "Chic");
	*/
});
</script>



</head>
<body>

<div id="myGanttCalendar">
</div>



</body>
</html>